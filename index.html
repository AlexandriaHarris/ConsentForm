<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Consent Builder – Single‑file HTML</title>
  <style>
    :root { --bg:#f7f7fb; --ink:#0f172a; --muted:#6b7280; --border:#e5e7eb; }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:var(--ink);background:linear-gradient(#fafafa,#f2f4f8)}
    h1,h2,h3{margin:0 0 .5rem}
    .app{max-width:1120px;margin:0 auto;padding:1rem}
    .topbar{position:sticky;top:0;background:rgba(255,255,255,.85);backdrop-filter:blur(8px);border-bottom:1px solid var(--border);z-index:50}
    .topbar .inner{display:flex;align-items:center;justify-content:space-between;gap:.75rem;padding:.5rem 1rem}
    .btn{appearance:none;border:1px solid var(--border);background:#fff;padding:.5rem .75rem;border-radius:.5rem;cursor:pointer;font-weight:600}
    .btn.primary{background:#111827;color:#fff;border-color:#111827}
    .btn:active{transform:translateY(1px)}
    .grid{display:grid;grid-template-columns:minmax(0,440px) 1fr;gap:1rem;margin:1rem auto}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    label{display:block;font-size:.75rem;color:var(--muted);margin:.25rem 0}
    input[type=text], textarea{width:100%;padding:.6rem .65rem;border:1px solid var(--border);border-radius:.5rem;background:#fff}
    textarea{resize:vertical}
    .list{display:grid;gap:.5rem}
    .check{display:flex;align-items:flex-start;gap:.5rem;font-size:.9rem}
    .check input{margin-top:.25rem}
    .border{border:1px solid var(--border);border-radius:.5rem;padding:.75rem}
    .actions{display:flex;gap:.5rem;align-items:center}
    /* Print preview */
    .sheet{position:relative;width:8.5in;height:11in;background:#fff;margin:0 auto;border:1px solid var(--border);box-shadow:0 3px 24px rgba(0,0,0,.12)}
    .header{position:absolute;left:0;right:0;top:0;height:1.25in;border-bottom:1px solid #000}
    .hdr{display:grid;grid-template-columns:1.6in 1fr;height:100%;padding:.25in .5in .2in .5in;column-gap:.3in;align-items:end}
    .hdr-left{display:flex;flex-direction:column;justify-content:space-between;align-items:flex-start}
    .hdr-right{font:10pt "Times New Roman",Times,serif;line-height:1.1;text-align:right}
    .logo{height:.275in;width:auto;display:block} /* Shrunk to 50% of original height (.55in) */
    .line{display:inline-block;min-width:10ch}
    .content{position:absolute;left:0.5in;right:0.5in;top:1.25in;bottom:.5in;padding:0;font:11pt "Times New Roman",Times,serif;line-height:1;overflow:hidden}
    .title{font-weight:700;text-align:center;margin:.15in 0;font-size:12pt}
    .small{font-size:9pt;text-align:center}
    .ol{padding-left:.25in}
    .ol li{margin:.08in 0}
  </style>
</head>
<body>
  <div class="app">
    <!-- Top bar -->
    <div class="topbar">
      <div class="inner">
        <button id="resetBtn" class="btn">Reset</button>
        <button id="printBtn" class="btn primary">Print / Save PDF</button>
      </div>
    </div>
    <!-- Layout -->
    <div class="grid">
      <!-- Left panel: form inputs -->
      <div>
        <!-- Patient & surgeon -->
        <div class="card">
          <div class="bd list">
            <div>
              <label for="patientName">Patient Name</label>
              <input id="patientName" type="text" data-field="patientName" />
            </div>
            <div>
              <label for="idNumber">MRN / Identification Number</label>
              <input id="idNumber" type="text" data-field="idNumber" />
            </div>
            <div>
              <label for="dob">Date of Birth</label>
              <input id="dob" type="text" data-field="dob" />
            </div>
            <div>
              <label for="facility">Facility</label>
              <input id="facility" type="text" data-field="facility" />
            </div>
            <div>
              <label for="consentForName">Name of patient or designee (signer)</label>
              <input id="consentForName" type="text" data-field="consentForName" />
            </div>
            <div>
              <label for="designeeName">Name of patient (if signer is a designee)</label>
              <input id="designeeName" type="text" data-field="designeeName" />
            </div>
            <div style="margin-top:.75rem">
              <div style="font-weight:600;margin-bottom:.25rem">Select surgeon</div>
              <select id="surgeonSelect" class="list" style="width:100%"></select>
              <div class="actions" style="margin-top:.5rem">
                <input id="newSurgeon" type="text" placeholder="Add surgeon full name" />
                <button class="btn" id="addSurgeonBtn">Add</button>
              </div>
            </div>
          </div>
        </div>
        <!-- Procedures -->
        <div class="card" style="margin-top:1rem">
          <div class="hd" style="padding:.75rem 1rem;font-weight:700">Procedures (multi‑select) & Risk Library</div>
          <div class="bd">
            <div id="procList" class="list"></div>
            <div id="lateralitySection" class="list" style="margin-top:.5rem; display:none"></div>
            <div class="border" style="margin-top:.75rem">
              <div style="font-weight:600;margin-bottom:.25rem">Add a procedure</div>
              <div class="list">
                <input id="procName" type="text" placeholder="Procedure name" />
                <textarea id="procRisks" rows="3" placeholder="Risks (comma or newline separated)"></textarea>
                <textarea id="procAlts" rows="2" placeholder="Alternatives (comma or newline separated)"></textarea>
                <label style="display:flex;align-items:center;font-size:.75rem">
                  <input type="checkbox" id="procLaterality" style="margin-right:.25rem">Requires laterality (L/R/B)
                </label>
                <div style="text-align:right"><button class="btn" id="addProcBtn">Add to Catalog</button></div>
              </div>
            </div>
          </div>
        </div>
        <!-- Auto-populated fields -->
        <div class="card" style="margin-top:1rem">
          <div class="hd" style="padding:.75rem 1rem;font-weight:700">Auto‑populated Fields (editable)</div>
          <div class="bd list">
            <div>
              <label for="diagnosis">Diagnosis</label>
              <textarea id="diagnosis" data-field="diagnosis" rows="3"></textarea>
            </div>
            <div>
              <label for="recommendedProcedure">Recommended Procedure (auto from selection — you can edit)</label>
              <textarea id="recommendedProcedure" data-field="recommendedProcedure" rows="2"></textarea>
            </div>
            <div>
              <label for="alternatives">Treatment Alternatives (auto from selection — you can edit)</label>
              <textarea id="alternatives" data-field="alternatives" rows="2"></textarea>
            </div>
            <div>
              <label for="otherRisks">Other risks (auto from selection — you can edit)</label>
              <textarea id="otherRisks" data-field="otherRisks" rows="4"></textarea>
            </div>
          </div>
        </div>
        <!-- Signatures & Times -->
        <div class="card" style="margin-top:1rem">
          <div class="hd" style="padding:.75rem 1rem;font-weight:700">Signatures & Times</div>
          <div class="bd">
            <div class="list">
              <div class="row" style="display:grid;grid-template-columns:1fr 1fr;gap:.75rem">
                <div>
                  <label for="signerDate">Signature Date (MM/DD/YYYY)</label>
                  <input type="text" id="signerDate" data-field="signerDate" />
                </div>
                <div>
                  <label for="signerTime">Signer Time (HH:MM)</label>
                  <input type="text" id="signerTime" data-field="signerTime" />
                </div>
                <div>
                  <label for="signerName">Printed name — patient or authorized person</label>
                  <input type="text" id="signerName" data-field="signerName" />
                </div>
                <div>
                  <label for="signerRelationship">Relationship to patient (if not patient)</label>
                  <input type="text" id="signerRelationship" data-field="signerRelationship" />
                </div>
                <div>
                  <label for="witnessName">Witness (printed name)</label>
                  <input type="text" id="witnessName" data-field="witnessName" />
                </div>
                <div>
                  <label for="witnessTime">Witness Time</label>
                  <input type="text" id="witnessTime" data-field="witnessTime" />
                </div>
                <div>
                  <label for="physSigName">Physician/Representative (printed name)</label>
                  <input type="text" id="physSigName" data-field="physSigName" />
                </div>
                <div>
                  <label for="physSigTime">Physician/Rep Time</label>
                  <input type="text" id="physSigTime" data-field="physSigTime" />
                </div>
                <div>
                  <label for="cyracom">Interpreter Cyracom ID (if applicable)</label>
                  <input type="text" id="cyracom" data-field="cyracom" />
                </div>
                <div>
                  <label for="interpName">Interpreter Print Name</label>
                  <input type="text" id="interpName" data-field="interpName" />
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Review -->
        <div class="card" style="margin-top:1rem">
          <div class="hd" style="padding:.75rem 1rem;font-weight:700">Selected Text — Review before printing</div>
          <div class="bd">
            <textarea id="reviewBox" rows="10" readonly style="width:100%"></textarea>
            <div class="actions" style="margin-top:.5rem">
              <button id="copyBtn" class="btn">Copy for Note</button>
              <div class="muted" style="font-size:.8rem">This box is for quick review and can be copied into your documentation.</div>
            </div>
          </div>
        </div>
      </div>
      <!-- Right panel: print preview -->
      <div class="right" style="overflow:auto;min-width:0">
        <div class="sheet">
          <div class="header">
            <div class="hdr">
              <div class="hdr-left">
                <!-- Replace src with your logo image -->
                <img class="logo" src="your-logo.png" alt="Logo">
                <div class="line hdrPatientName">____________________</div>
                <div class="line hdrId">______________</div>
                <div class="line hdrDob">______________</div>
                <div class="line hdrFacility">______________</div>
              </div>
              <div class="hdr-right">
                <div class="title">Consent to Surgery or Special Procedure</div>
                <div class="small">(Form preview)</div>
              </div>
            </div>
          </div>
          <div class="content">
            <!-- Insert your full legal consent text here; placeholders will be filled by script -->
            <p id="p1_diagnosis"></p>
            <p><strong>Recommended Procedure:</strong> <span id="p1_recommended"></span></p>
            <p><strong>Alternatives:</strong> <span id="p1_alternatives"></span></p>
            <p><strong>Other Risks:</strong> <span id="p2_otherRisks"></span></p>
            <!-- Add more sections/pages as needed -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Script -->
  <script>
    /* The JavaScript code provided earlier goes here.  
       For readability, you can embed the full script from the previous answer 
       starting with the utilities (const $ = …) and ending with the DOMContentLoaded 
       initialization. */
  </script>
</body>
</html>
